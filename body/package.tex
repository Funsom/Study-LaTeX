\newpage
\chapter{宏包}
\thispagestyle{chapterpage}

\LaTeX{}的强大之处在于有各种各样的宏包进行扩展，这些宏包能帮助\LaTeX{}完成多样的排版任务。

例如，在文本中排版化学式，有两个宏包比较流行，mhchem和chemfig。前者功能简单，用法也简单，书写无机化学式首选；后者功能众多，用法也较为繁复，主要用来书写复杂的有机化学式。

\section{mhchem}

使用下面的语句调用mhchem宏包，添加\lstinline|version=4|参数是为了使用宏包的一些新特性，编写的文档如果要照顾老旧的\LaTeX 版本用户，可以酌情降低版本。

\begin{latex}
\usepackage[version=4]{mhchem}
\end{latex}

\bz{化学方程式}

\begin{codeshow}
\ce{CO2 + C -> 2 CO}\par
\ce{Hg^2+ ->[I-] HgI2
    ->[I-] [Hg^{II}I4]^2-}
\end{codeshow}

\bz{化学分子式}

分子式可用在文本模式、数学模式和标题里面。

\begin{codeshow}
\ce{H2O}\par
\ce{Sb2O3}
 \end{codeshow}

\bz{离子}

\begin{codeshow}
\ce{H+}\par
\ce{CrO4^2-}\par
\ce{[AgCl2]-}\par
\ce{Y^99+}\par
\ce{Y^{99+}}
\end{codeshow}

\bz{氧化价态}

\begin{codeshow}
\ce{Fe^{II}Fe^{III}2O4}
\end{codeshow}

\bz{化学计量数}

\begin{codeshow}
\ce{2H2O}\par
\ce{2 H2O}\par
\ce{0.5H2O}\par
\ce{1/2H2O}\par
\ce{(1/2)H2O}\par
\ce{$n$H2O}
\end{codeshow}

\bz{同位素}

\begin{codeshow}
\ce{^{227}_{90}Th+}\par
\ce{^227_90Th+}\par
\ce{^{0}_{-1}n^{-}}\par
\ce{^0_-1n-}
\end{codeshow}

\bz{括弧,方括号,花括号}

\lstinline|(),[]|可以正常表示，但需要使用\lstinline|\{ \}|输出花括号 。大型的花括号只能在数学环境里面使用。

\begin{codeshow}
\ce{(NH4)2S}\par
\ce{[\{(X2)3\}2]^3+}
\end{codeshow}

\bz{大花括号}
\begin{latex}
\[\ce{CH4 + 2 $\left( \ce{O2 + 79/21 N2} \right)$}\]
\end{latex}

\[\ce{CH4 + 2 $\left( \ce{O2 + 79/21 N2} \right)$}\]

\bz{聚合态}

\begin{codeshow}
\ce{H2(aq)}\par
\ce{CO3^2-{}_{(aq)}}\par
\ce{NaOH(aq,$\infty$)}
\end{codeshow}

\bz{未成对电子，自由基}

\begin{codeshow}
\ce{OCO^{.-}}\par
\ce{NO^{(2.)-}}
\end{codeshow}

\bz{变量}
排版约定，变量使用斜体排版，而其他元素（如化学式）则使用直立字体排版。

\begin{codeshow}
$\ce{NO_x}$\par
$\ce{Fe^n+}$
\end{codeshow}

\begin{latex}
$\ce{x Na(NH4)HPO4 ->[\Delta] (NaPO3)_x + x NH3 ^ + x H2O}$
\end{latex}

\begin{center}
    $\ce{x Na(NH4)HPO4 ->[\Delta] (NaPO3)_x + x NH3 ^ + x H2O}$
\end{center}

\bz{希腊字符}
\begin{codeshow}
\ce{\mu-Cl}\par
\ce{[Pt(\eta^2-C2H4)Cl3]-}
\end{codeshow}

\bz{加成化合物}
\begin{codeshow}
\ce{KCr(SO4)2*12H2O}\par
\ce{KCr(SO4)2.12H2O}\par
\ce{KCr(SO4)2 * 12 H2O}
\end{codeshow}

\bz{化学键}
\begin{codeshow}
\ce{C6H5-CHO}\par
\ce{A-B=C#D}\par
\sffamily\bfseries\ce{A-B=C#D}
\end{codeshow}

\begin{codeshow}
\ce{A\bond{-}B\bond{=}C\bond{#}D}\par
\ce{A\bond{1}B\bond{2}C\bond{3}D}\par
\ce{A\bond{~}B\bond{~-}C}\par
\ce{A\bond{~--}B\bond{~=}C\bond{-~-}D}\par
\ce{A\bond{...}B\bond{....}C}\par
\ce{A\bond{->}B\bond{<-}C}
\end{codeshow}

\bz{反应箭头}
\begin{codeshow}
\ce{A -> B}\par
\ce{A <- B}\par
\ce{A <-> B}\par
\ce{A <--> B}\par
\ce{A <=>> B}\par
\ce{A <<=> B}
\end{codeshow}

\bz{带参数的反应箭头}
\begin{codeshow}
\ce{A ->[H2O] B}\par
\ce{A ->[{text above}][{text below}] B}\par
\ce{A ->[$x$][$x_i$] B}\par
\ce{A ->[${x}$] B}
\end{codeshow}

\bz{化学方程式计算符}
\begin{codeshow}
\ce{A + B}\par
\ce{A - B}\par
\ce{A = B}\par
\ce{A \pm B}
\end{codeshow}

\bz{沉淀和气体}
\begin{codeshow}
\ce{SO4^2- + Ba^2+ -> BaSO4 v}\par
\ce{A v B (v) -> B ^ B (^)}
\end{codeshow}

\bz{极好的示例}

\begin{latex}
\ce{Zn^2+
    <=>[+ 2OH-][+ 2H+]
    $\underset{\text{amphoteres Hydroxid}}{\ce{Zn(OH)2 v}}$
    <=>[+ 2OH-][+ 2H+]
    $\underset{\text{Hydroxozikat}}{\ce{[Zn(OH)4]^2-}}$
}

$K = \frac{[\ce{Hg^2+}][\ce{Hg}]}{[\ce{Hg2^2+}]}$

$K = \ce{\frac{[Hg^2+][Hg]}{[Hg2^2+]}}$

\ce{Hg^2+ ->[I-]
    $\underset{\mathrm{red}}{\ce{HgI2}}$
    ->[I-]
    $\underset{\mathrm{red}}{\ce{[Hg^{II}I4]^2-}}$
}
\end{latex}

\begin{center}
\ce{Zn^2+
    <=>[+ 2OH-][+ 2H+]
    $\underset{\text{amphoteres Hydroxid}}{\ce{Zn(OH)2 v}}$
    <=>[+ 2OH-][+ 2H+]
    $\underset{\text{Hydroxozikat}}{\ce{[Zn(OH)4]^2-}}$
}

$K = \frac{[\ce{Hg^2+}][\ce{Hg}]}{[\ce{Hg2^2+}]}$

$K = \ce{\frac{[Hg^2+][Hg]}{[Hg2^2+]}}$

\ce{Hg^2+ ->[I-]
    $\underset{\mathrm{red}}{\ce{HgI2}}$
    ->[I-]
    $\underset{\mathrm{red}}{\ce{[Hg^{II}I4]^2-}}$
}
\end{center}

\section{Chemfig}

\section{\CTeX zhnumber}

以中文格式输出数字。这里的数字可以是整数、小数和分数。

\begin{codeshow}
\zhnumber{2012020120}\\
\zhnumber{2 012 020 120}\\
\zhnumber{2,012,020,120}\\
\zhnumber{2012.020120}\\
\zhnumber{2012.}\\
\zhnumber{.2012}\\
\zhnumber{20120/20120}\\
\zhnumber{/2012}\\
\zhnumber{2012/}\\
\zhnumber{201;2020/120}
\end{codeshow}

将阿拉伯数字转换为中文字符串。
\begin{codeshow}
\zhdigits{2012020120}\\
\zhdigits*{2012020120}
\end{codeshow}

将\LaTeX 计数器数值转换为中文。

\begin{latex}
\zhnum{section}
\end{latex}

输出当天的星期。

\begin{codeshow}
\zhweekday{2012/5/20}
\end{codeshow}

以中文格式输出日期。

\begin{codeshow}
\zhdate{2012/5/21}\\
\zhdate*{1995/01/26}
\end{codeshow}

以中文输出当天日期。

\begin{codeshow}
\zhtoday
\end{codeshow}

以中文输出时间。

\begin{codeshow}
\zhtime{23:56}
\end{codeshow}

输出当前时间。

\begin{codeshow}
\zhcurrtime
\end{codeshow}

输出天干计数，数字范围是1--10。

\begin{codeshow}
\zhtiangan{1} \zhtiangan{2}
\zhtiangan{3} \zhtiangan{4}
\zhtiangan{5} \zhtiangan{10}
\end{codeshow}

输出地支计数，数字范围1--12。

\begin{codeshow}
\zhdizhi{1} \zhdizhi{2} \zhdizhi{3}
\zhdizhi{4} \zhdizhi{5} \zhdizhi{12}
\end{codeshow}

输出干支计数，数字范围1--60。

\begin{codeshow}
\zhganzhi{1} \zhganzhi{2}
\zhganzhi{3}\\ \zhganzhi{4}
\zhganzhi{5} \zhganzhi{60}
\end{codeshow}

输出公元纪年对应的干支纪年，公元前用负数。

\begin{codeshow}
\zhganzhinian{1898}
\zhganzhinian{-246} \\
\zhganzhinian{-2697}
\zhganzhinian{\year}
\end{codeshow}

\emph{zhnumsetup}的样式控制选项。

\begin{description}
    \item [Simplified] 以简体中文输出数字（对Big5 编码无效）
    \item [Traditional] 以繁体中文输出数字（对Big5 编码无效）
    \item [Normal] 以小写形式输出中文数字
    \item [Financial] 以大写形式输出中文数字
    \item [Ancient] 以廿输出20，以卅输出30，以卌输出40，以皕输出200
\end{description}

\begin{codeshow}
\zhnumsetup{
    style={Traditional,Normal}}
\zhnumber{62012.3}\\
\zhnumsetup{style=Ancient}
\zhnumber{21}
\end{codeshow}

\begin{codeshow}
\zhnumsetup{
    style={Traditional,Financial}}
\zhnumber{62012.3}\\
\zhnumsetup{style=Ancient}
\zhnumber{21}
\end{codeshow}

\section{xpinyin}

\section{siunitx}
这是一个用于书写标准国际单位制的宏包。

\subsection{数字}

\bz{数字输入}

使用d，D代表$\times10^{x}$，使用e，E代表$10^{x}$，英文的逗号,和句号.均可以做为小数点。

\begin{codeshow}
\num{12345} \\
\num{0.123} \\
\num{0,1234} \\
\num{.12345} \\
\num{3.45d-4} \\
\num{2.2D-9} \\
\num{E9} \\
\num{-e10}
\end{codeshow}

\bz{数字列表和范围}

\begin{codeshow}
\numlist{10;30;50;70}
\numrange{10}{30}
\end{codeshow}

\bz{角度}

使用英文的分号;分割角度（度分秒），英文的逗号,和句号.均可以做为小数点。

\begin{codeshow}
\ang{10} \\
\ang{12.3} \\
\ang{4,5} \\
\ang{1;2;3} \\
\ang{;;1} \\
\ang{+10;;} \\
\ang{-0;1;}
\end{codeshow}

\subsection{单位}

当仅仅输入单位时，使用\lstinline|\si|，英文.和\~{}隔开的单位会被视为相邻单位。

\begin{codeshow}
\si{kg.m/s^2} \\
\si{g_{polymer}~mol_{cat}.s^{-1}}
\end{codeshow}

很多时候，数字和单位是在一起的，同时输入使用\lstinline|\SI|命令。\lstinline|\SI|命令结合了\lstinline|\num|和\lstinline|\si|两者的作用。可以使用可选参数输入一个前置单位，该单位将会排版在数字之前。

\note{在siunitx宏包环境外使用siunitx宏包的命令需要小心，因为如果其他宏包定义了相同的命令，就会有命名冲突。}

\lstinline|\per|有多种模式，可以是分数形式。

\begin{codeshow}
\SI[mode=text]{1.23}{J.mol^{-1}.K^{-1}} \\
\SI{.23e7}{\candela} \\
\SI[per-mode=symbol]{1.99}[\$]{\per\kilogram} \\
\SI[per-mode=fraction]{1,345}{\coulomb\per\mole}
\end{codeshow}

\bz{带单位的数字列表和范围}

\begin{codeshow}
\SIlist{10;30;45}{\metre}
\SIrange{10}{30}{\metre}
\end{codeshow}

\subsection{单位命令}

\subsection{在表格中使用单位命令}

\section{pgfplots}
这是一个用于2D/3D图像绘制的宏包。

\section{mathtools}
这是一个数学宏包，主要填补了\hologo{AmSTeX}宏包的不足。

\subsection{单花括号环境}

mathtools提供了更好的单花括号环境，用法与\hologo{AmSTeX}宏包提供的别无二致，但显示的效果更完美。\lstinline|&|用于分列，\textbf{奇数列会右对齐，偶数列会左对齐}。

\begin{latex}
\begin{dcases} & \end{dcases}
\begin{dcases*} & \end{dcases*}
\begin{rcases} & \end{rcases}
\begin{rcases*} & \end{rcases*}
\begin{drcases} & \end{drcases}
\begin{drcases*} & \end{drcases*}
\begin{cases*} & \end{cases*}
\end{latex}

\begin{codeshow}
\[
\begin{dcases}
E = m c^2 & c \approx 3.00\times 10^{8}\,\mathrm{m}/\mathrm{s} \\
\int x-3\, dx & \text{Integral is display style}
\end{dcases}
\]
\end{codeshow}

带*的环境有个细微的差别，就是第二列会默认用罗马体（直立的）显示，更加方便输入纯文字。

\begin{codeshow}
\[
a= \begin{dcases*}
E = m c^2 & c≈3.00×10e8~m/s \\
\int x-3\, dx & Integral is display style
\end{dcases*}
\]
\end{codeshow}

\begin{codeshow}
\[
\begin{rcases*}
x^2 & for $x>0$\\
x^3 & else
\end{rcases*} \quad \Rightarrow \cdots
\]
\end{codeshow}

\subsection{更好的矩阵环境}

\hologo{AmSTeX}宏包提供的矩阵默认是每列都居中的，mathtools宏包提供了一些带星号的矩阵环境，可以手动设置列对齐的方式。

\begin{latex}
\begin{matrix*} [position]  \end{matrix*}%无括号
\begin{pmatrix*}[position]  \end{pmatrix*}%圆括号
\begin{bmatrix*}[position]  \end{bmatrix*}%方括号
\begin{Bmatrix*}[position]  \end{Bmatrix*}%花括号
\begin{vmatrix*}[position]  \end{vmatrix*}%单竖线，行列式形式
\begin{Vmatrix*}[position]  \end{Vmatrix*}%双竖线
\end{latex}

对比一下两者的排版效果，mathtools可按需求设置对齐方式，排版效果要更好。

\begin{codeshow}
\[\begin{pmatrix*}[r]
-1 & 3 \\
2 & -4
\end{pmatrix*}\]
\[\begin{pmatrix}
-1 & 3 \\
2 & -4
\end{pmatrix}\]
\end{codeshow}

mathtools还提供小矩阵环境，做为行内公式时更加协调，例如：$ \begin{bsmallmatrix*}[r] a & -b \\ -c & d \end{bsmallmatrix*} $。其用法与行间矩阵完全一致，带*的可调整对齐方式。

\begin{latex}
\begin{smallmatrix}   \end{smallmatrix}
\begin{smallmatrix*} [position]  \end{smallmatrix*}
\begin{psmallmatrix}  \end{psmallmatrix}
\begin{psmallmatrix*}[position]  \end{psmallmatrix*}
\begin{bsmallmatrix}  \end{bsmallmatrix}
\begin{bsmallmatrix*}[position]  \end{bsmallmatrix*}
\begin{Bsmallmatrix}  \end{Bsmallmatrix}
\begin{Bsmallmatrix*}[position]  \end{Bsmallmatrix*}
\begin{vsmallmatrix}  \end{vsmallmatrix}
\begin{vsmallmatrix*}[position]  \end{vsmallmatrix*}
\begin{Vsmallmatrix}  \end{Vsmallmatrix}
\begin{Vsmallmatrix*}[position]  \end{Vsmallmatrix*}
\end{latex}

\subsection{长分式}
有时候遇到的分式分子特别长，长到爆的那一种。这时候就需要分子能换行书写了。mathtools宏包提供两个命令用来书写分子过长的分式。

\begin{latex}
\splitfrac
\splitdfrac
\end{latex}

\begin{codeshowabove}
\[
a=\frac{
    \splitfrac{xy + xy + xy + xy + xy}
    {+ xy + xy + xy + xy}
}
{z}
=\frac{
    \splitdfrac{xy + xy + xy + xy + xy}
    {+ xy + xy + xy + xy}
}
{z}
\]
\end{codeshowabove}
